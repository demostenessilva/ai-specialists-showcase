<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Confidential Computing Cross-Cloud - ROI 367x, Score 9.9/10">
    <meta name="keywords" content="confidential computing, security, aws nitro, azure sev-snp, gcp, zero trust, roi">
    <meta name="author" content="Demóstenes Silva">
    
    <title>Security - Confidential Computing Cross-Cloud | ROI 367x</title>
    
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div class="container">
        <!-- Back Button -->
        <a href="../index.html" class="back-button">← Voltar para Especialistas</a>
        
        <!-- Hero Section -->
        <div class="hero">
            <div class="specialist-icon-large">🔒</div>
            <h1>Security - Confidential Computing Cross-Cloud</h1>
            <p class="subtitle">Zero Trust de Hardware com AWS Nitro, Azure SEV-SNP e GCP SEV</p>
            
            <div class="badges">
                <span class="badge badge-score">Score: 9.9/10 ⭐⭐⭐⭐⭐</span>
                <span class="badge badge-roi">ROI: 367x 🔥</span>
                <span class="badge badge-enterprise">Payback: &lt;1 dia</span>
            </div>
            
            <div class="roi-highlight">
                <strong>Investimento:</strong> $102K/ano → <strong>Risco Evitado:</strong> $37.5M/ano
            </div>
        </div>
        
        <!-- Business Context -->
        <div class="section">
            <h2>🏢 Contexto Empresarial</h2>
            <div class="context-grid">
                <div class="context-item">
                    <div class="context-icon">💰</div>
                    <h3>Problema Crítico de Negócio</h3>
                    <p>Dados altamente sensíveis (PII, dados financeiros, IP) precisam ser processados em nuvem para ML/analytics. Criptografia tradicional (em trânsito e em repouso) <strong>NÃO protege dados EM USO</strong>, deixando uma janela de vulnerabilidade para:</p>
                    <ul style="margin-top: 0.5rem;">
                        <li>Ataques de nível de hipervisor</li>
                        <li>Insiders mal-intencionados</li>
                        <li>Subpoenas governamentais</li>
                    </ul>
                </div>
                
                <div class="context-item">
                    <div class="context-icon">📉</div>
                    <h3>Impacto Financeiro da Inação</h3>
                    <ul>
                        <li><strong>$5.5M</strong> - Custo médio de violação de dados confidenciais (Ponemon 2024)</li>
                        <li><strong>$10M+ ARR</strong> - Perda de contratos enterprise (HIPAA, PCI-DSS, FedRAMP)</li>
                        <li><strong>$2M</strong> - Custo de vendor lock-in em 3 anos</li>
                        <li><strong>até $20M</strong> - Multas LGPD/GDPR (4% faturamento global)</li>
                    </ul>
                </div>
                
                <div class="context-item">
                    <div class="context-icon">📈</div>
                    <h3>ROI Quantificado</h3>
                    <p><strong>Investimento Total (Ano 1):</strong> $102,320</p>
                    <ul>
                        <li>$65,520 - Infraestrutura (AWS/Azure/GCP)</li>
                        <li>$36,000 - HashiCorp Vault Enterprise</li>
                        <li>$800 - Azure MAA (attestation)</li>
                    </ul>
                    <p style="margin-top: 1rem;"><strong>Retorno / Risco Evitado:</strong></p>
                    <ul>
                        <li>$5.5M - Prevenção de 1 violação</li>
                        <li>$10M ARR - Contratos habilitados</li>
                        <li>$2M - Evita vendor lock-in</li>
                        <li>$20M - Mitiga multas regulatórias</li>
                    </ul>
                    <p class="roi-total"><strong>ROI: 367x</strong> | <strong>Payback: &lt;1 dia</strong></p>
                </div>
            </div>
        </div>
        
        <!-- Architecture Diagram -->
        <div class="section">
            <h2>🏗️ Arquitetura de Confidential Computing Unificada</h2>
            <div class="diagram">
                <pre>
┌─────────────────────────────────────────────────────────────────┐
│                    CLIENT APPLICATION                           │
│              (Mobile App, Web Frontend)                         │
└────────────────────┬────────────────────────────────────────────┘
                     │
                     │ 1. Attested TLS 1.3 Handshake
                     │    (Client verifica identidade do enclave/VM)
                     │
         ┌───────────▼──────────┬──────────────┬─────────────────┐
         │                      │              │                 │
    ┌────▼─────┐         ┌─────▼──────┐  ┌───▼──────────┐      │
    │ AWS      │         │ AZURE      │  │ GCP          │      │
    │ Nitro    │         │ Confidential│  │ Confidential │      │
    │ Enclaves │         │ VM (SEV-SNP)│  │ VM (SEV)     │      │
    └────┬─────┘         └─────┬──────┘  └───┬──────────┘      │
         │ 2a. NSM           │ 2b. MAA       │ 2c. vTPM        │
         │ Attestation       │ Attestation   │ Attestation     │
         │ (PCR Hashes)      │ (SNP Report)  │ (Quote)         │
         └───────────────────┼───────────────┴─────────────────┘
                             │
                             │ 3. Unified Attestation Validation
                             │
                    ┌────────▼────────┐
                    │ HASHICORP VAULT │
                    │  (Central KMS)  │
                    │                 │
                    │ - JWT/OIDC Auth │
                    │ - Dynamic Secrets│
                    │ - Policy Engine │
                    └─────────────────┘
                             │
                             │ 4. Secrets/Keys Delivered ONLY to
                             │    Attested & Verified Environments
                             │
         ┌───────────────────┴─────────────────┐
         │    DECRYPTED DATA (ONLY IN MEMORY)  │
         │   (PII, Financial Data, Health Data)│
         └─────────────────────────────────────┘
                </pre>
            </div>
            
            <div class="architecture-highlights">
                <h3>Decisões Arquiteturais Críticas</h3>
                <div class="highlight-grid">
                    <div class="highlight-item">
                        <h4>🛡️ Zero Trust de Hardware à Aplicação</h4>
                        <p><strong>Por quê?</strong> O atestado garante que estamos falando com o código correto, rodando no hardware correto, na nuvem correta, antes que qualquer segredo seja liberado.</p>
                        <p><strong>Impacto:</strong> Elimina confiança implícita no hipervisor ou no provedor de nuvem. Mesmo com acesso root, um atacante não consegue extrair dados em memória.</p>
                    </div>
                    
                    <div class="highlight-item">
                        <h4>🔑 Unified Key Management (Vault)</h4>
                        <p><strong>Por quê?</strong> Vault atua como "broker de confiança" agnóstico à nuvem, evitando complexidade de gerenciar 3 KMS diferentes (AWS KMS, Azure Key Vault, GCP KMS).</p>
                        <p><strong>Economia:</strong> $50K/ano em complexidade operacional + 2 FTEs reduzidos para 0.5 FTE.</p>
                    </div>
                    
                    <div class="highlight-item">
                        <h4>🌐 Multi-Cloud por Design</h4>
                        <p><strong>Por quê?</strong> Evita vendor lock-in. Cargas de trabalho podem ser movidas para a nuvem com melhor custo-benefício sem redesenhar a segurança.</p>
                        <p><strong>Valor:</strong> Economia de $2M em 3 anos (custo de migração evitado).</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Implementation: AWS Nitro Enclaves -->
        <div class="section">
            <h2>⚙️ Implementação Técnica Detalhada</h2>
            
            <h3>1. AWS Nitro Enclaves (Isolamento Máximo)</h3>
            <p style="color: #666; margin-bottom: 1rem;">Caso de Uso: Processamento de dados altamente sensíveis em ambiente de isolamento máximo.</p>
            <div class="code-block">
                <pre><code># ════════════════════════════════════════════════════════════
# 1. Provisionar instância EC2 com suporte a Enclaves
# ════════════════════════════════════════════════════════════
aws ec2 run-instances \
  --image-id ami-0c55b159cbfafe1f0 \
  --instance-type c6a.xlarge \
  --enclave-options Enabled=true \
  --iam-instance-profile Name=NitroEnclaveRole

# ════════════════════════════════════════════════════════════
# 2. Instalar ferramentas e alocar recursos para o enclave
# ════════════════════════════════════════════════════════════
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Configurar recursos (em /etc/nitro_enclaves/allocator.yaml):
# memory_mib: 4096
# cpu_count: 2

sudo systemctl start nitro-enclaves-allocator.service

# ════════════════════════════════════════════════════════════
# 3. Construir a imagem do enclave a partir de um Dockerfile
# ════════════════════════════════════════════════════════════
nitro-cli build-enclave \
  --docker-uri confidential-app:latest \
  --output-file app.eif

# ════════════════════════════════════════════════════════════
# 4. Executar o enclave e obter o documento de atestado
# ════════════════════════════════════════════════════════════
nitro-cli run-enclave \
  --eif-path app.eif \
  --cpu-count 2 \
  --memory 4096 \
  --debug-mode

ATTESTATION_DOC=$(nitro-cli get-attestation-document)

# ════════════════════════════════════════════════════════════
# PCRs (Platform Configuration Registers) para validação
# ════════════════════════════════════════════════════════════
# Exemplo de PCRs esperados no Vault Policy:
# {
#   "PCR0": "a1b2c3d4e5f6...",  // Hash da imagem do enclave (EIF)
#   "PCR1": "f6e5d4c3b2a1...",  // Hash do kernel
#   "PCR2": "1234567890ab...",  // Hash da aplicação
#   "PCR8": "5678901234ab..."   // Hash do certificado TLS
# }</code></pre>
            </div>
            
            <h3>2. Azure Confidential VMs (AMD SEV-SNP)</h3>
            <p style="color: #666; margin-bottom: 1rem;">Caso de Uso: Migração "lift-and-shift" de aplicações para ambiente confidencial sem reescrever código.</p>
            <div class="code-block">
                <pre><code># ════════════════════════════════════════════════════════════
# 1. Criar uma VM Confidencial com proteção de estado
# ════════════════════════════════════════════════════════════
az vm create \
  --resource-group rg-confidential \
  --name confidential-vm \
  --size Standard_DC4ads_v5 \
  --image "Canonical:0001-com-ubuntu-server-jammy:22_04-lts-gen2:latest" \
  --security-type ConfidentialVM \
  --os-disk-security-encryption-type VMGuestStateOnly \
  --enable-secure-boot true \
  --enable-vtpm true

# ════════════════════════════════════════════════════════════
# 2. Fluxo de Atestado com Azure Attestation Service (MAA)
# ════════════════════════════════════════════════════════════</code></pre>
            </div>
            
            <div class="code-block">
                <pre><code># Python script dentro da VM para obter atestado
import requests
import base64

# 1. Obter SNP report do hardware (via ioctl /dev/sev-guest)
snp_report = get_hardware_snp_report() 
nonce = "random_nonce_123"

# 2. Enviar para o serviço de atestado da Azure
attestation_url = "https://sharedwus.wus.attest.azure.net/attest/SevSnpVm"
response = requests.post(
    attestation_url,
    params={"api-version": "2022-08-01"},
    json={
        "quote": base64.b64encode(snp_report).decode(),
        "runtimeData": {
            "data": base64.b64encode(nonce.encode()).decode(),
            "dataType": "Binary"
        }
    }
)

# 3. MAA valida e retorna JWT assinado
attestation_token = response.json()['token']

# 4. JWT é enviado ao Vault para autenticação</code></pre>
            </div>
            
            <h3>3. HashiCorp Vault (Unified KMS)</h3>
            <p style="color: #666; margin-bottom: 1rem;">Vault atua como ponto central de decisão de confiança, validando atestados de todas as 3 clouds.</p>
            <div class="code-block">
                <pre><code># ════════════════════════════════════════════════════════════
# 1. Habilitar o método de autenticação JWT
# ════════════════════════════════════════════════════════════
vault auth enable jwt

# ════════════════════════════════════════════════════════════
# 2. Configurar Vault para confiar nos emissores de atestado
# ════════════════════════════════════════════════════════════

# Para AWS Nitro (OIDC provider customizado)
vault write auth/jwt/config \
  oidc_discovery_url="https://my-oidc-provider.com/nitro" \
  bound_issuer="https://my-oidc-provider.com/nitro"

# Para Azure (Microsoft Attestation Service)
vault write auth/jwt/config \
  oidc_discovery_url="https://sharedwus.wus.attest.azure.net" \
  bound_issuer="https://sharedwus.wus.attest.azure.net"

# ════════════════════════════════════════════════════════════
# 3. Criar roles que mapeiam claims de atestado para políticas
# ════════════════════════════════════════════════════════════

# Role para AWS Nitro Enclaves
vault write auth/jwt/role/nitro-enclave-role \
  role_type="jwt" \
  bound_audiences="vault.mycorp.com" \
  user_claim="instance_id" \
  policies="confidential-data-policy" \
  ttl=1h \
  bound_claims='{
    "pcr0": "a1b2c3d4e5f6...",
    "pcr1": "f6e5d4c3b2a1..."
  }'

# Role para Azure Confidential VMs
vault write auth/jwt/role/azure-confidential-vm-role \
  role_type="jwt" \
  bound_audiences="vault.mycorp.com" \
  user_claim="x-ms-vm-id" \
  policies="confidential-data-policy" \
  ttl=1h \
  bound_claims='{
    "x-ms-attestation-type": "sevsnpvm",
    "x-ms-compliance-status": "azure-compliant-uvm"
  }'</code></pre>
            </div>
        </div>
        
        <!-- Red Team Exercise -->
        <div class="section">
            <h2>🔴 Red Team Exercise (Validação de Attestation)</h2>
            <p style="color: #666; margin-bottom: 1.5rem;">Um controle que não é testado é um controle que não existe. A seguir, o procedimento formal para validar a integridade do processo de attestation.</p>
            
            <h3>Objetivo: Provar Resiliência a Comprometimento de Host</h3>
            <p style="color: #666; margin-bottom: 1rem;">Validar que, mesmo com acesso root a uma instância confidencial, um ator malicioso <strong>NÃO CONSEGUE</strong> se autenticar no Vault, pois a violação de integridade será detectada pelo attestation.</p>
            
            <h3>Fase 1: BASELINE (Estado Válido)</h3>
            <div class="code-block">
                <pre><code># Executar script de attestation em ambiente íntegro
./cross-cloud-attestation-validator.sh

# ━━━━━━━━━━━━━━━ OUTPUT ESPERADO ━━━━━━━━━━━━━━━
# ☁️  Detectado: AWS Nitro Enclave
# ✅ PCRs lidos com sucesso
# 🔐 Autenticando no Vault com attestation...
# ✅ ATTESTATION VÁLIDO - Acesso ao Vault concedido
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Capturar PCRs "golden" (valores corretos)
nitro-cli describe-enclaves | jq -r '.[0].Measurements' > pcrs_golden.json</code></pre>
            </div>
            
            <h3>Fase 2: ATAQUE (Simulação de Comprometimento)</h3>
            <div class="code-block">
                <pre><code># ════════════════════════════════════════════════════════════
# ATAQUE: Modificar a imagem do enclave
# ════════════════════════════════════════════════════════════

# 1. Adicionar arquivo malicioso ao Dockerfile
cd /path/to/dockerfile
echo "malicious code" > malicious_file.txt
# Modificar Dockerfile para incluir: COPY malicious_file.txt /app/

# 2. Reconstruir imagem comprometida
docker build -t confidential-app:compromised .
nitro-cli build-enclave \
  --docker-uri confidential-app:compromised \
  --output-file compromised.eif

# 3. Executar enclave comprometido
nitro-cli run-enclave \
  --eif-path compromised.eif \
  --cpu-count 2 \
  --memory 4096

# 4. Observar mudança no PCR
nitro-cli describe-enclaves | jq -r '.[0].Measurements' > pcrs_compromised.json

GOLDEN_PCR0=$(cat pcrs_golden.json | jq -r '.PCR0')
COMPROMISED_PCR0=$(cat pcrs_compromised.json | jq -r '.PCR0')

echo "Golden PCR0:      $GOLDEN_PCR0"
echo "Compromised PCR0: $COMPROMISED_PCR0"

if [ "$GOLDEN_PCR0" != "$COMPROMISED_PCR0" ]; then
    echo "✅ SUCESSO: PCR0 foi alterado como esperado"
else
    echo "❌ FALHA: PCR0 não mudou - ataque falhou"
    exit 1
fi</code></pre>
            </div>
            
            <h3>Fase 3: VERIFICAÇÃO (Tentativa de Acesso Pós-Comprometimento)</h3>
            <div class="code-block">
                <pre><code># Tentar autenticar no Vault com o ambiente comprometido
./cross-cloud-attestation-validator.sh

# ━━━━━━━━━━━━━━━ OUTPUT ESPERADO ━━━━━━━━━━━━━━━
# ☁️  Detectado: AWS Nitro Enclave
# ✅ PCRs lidos (com valores alterados)
# 🔐 Autenticando no Vault com attestation...
# 
# Error making API request.
# URL: PUT https://vault.example.com/v1/auth/jwt/login
# Code: 400. Errors:
# * "pcr0" claim value ("ABC123...") does not match 
#   configured bound claim value ("a1b2c3d4...")
#
# ❌ ATTESTATION INVÁLIDO - Acesso negado
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</code></pre>
            </div>
            
            <h3>Critérios de Sucesso</h3>
            <div class="highlight-grid">
                <div class="highlight-item">
                    <h4>✅ SUCESSO</h4>
                    <ul style="list-style: none; padding: 0; margin-top: 0.5rem;">
                        <li>• PCRs alterados em todas as 3 plataformas</li>
                        <li>• Vault REJEITOU autenticação</li>
                        <li>• Alerta crítico no Splunk < 5min (MTTD)</li>
                    </ul>
                </div>
                
                <div class="highlight-item">
                    <h4>❌ FALHA (Vulnerabilidade)</h4>
                    <ul style="list-style: none; padding: 0; margin-top: 0.5rem;">
                        <li>• PCRs NÃO alterados</li>
                        <li>• Vault ACEITOU token comprometido</li>
                        <li>• Nenhum alerta gerado</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Cost Breakdown -->
        <div class="section">
            <h2>💰 Breakdown de Custos</h2>
            
            <table class="cost-table">
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Detalhe</th>
                        <th>Custo Anual</th>
                        <th>Justificativa</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Infraestrutura AWS</td>
                        <td>10x c6a.xlarge instances</td>
                        <td>$13,320</td>
                        <td>Isolamento máximo (Nitro Enclaves)</td>
                    </tr>
                    <tr>
                        <td>Infraestrutura Azure</td>
                        <td>10x DC4ads_v5 VMs</td>
                        <td>$16,800</td>
                        <td>Lift-and-shift de apps existentes</td>
                    </tr>
                    <tr>
                        <td>Infraestrutura GCP</td>
                        <td>10x N2D-standard-4 VMs</td>
                        <td>$12,720</td>
                        <td>Alternativa competitiva</td>
                    </tr>
                    <tr>
                        <td>Attestation Services</td>
                        <td>Azure MAA (10M requests)</td>
                        <td>$800</td>
                        <td>Custo marginal para validação</td>
                    </tr>
                    <tr>
                        <td>Key Management</td>
                        <td>HashiCorp Vault Enterprise</td>
                        <td>$36,000</td>
                        <td>Economiza $50K/ano vs 3 KMS separados</td>
                    </tr>
                    <tr>
                        <td>Recursos Humanos</td>
                        <td>0.5 FTE Security Engineer</td>
                        <td>$90,000</td>
                        <td>Automação reduz de 2 FTEs para 0.5</td>
                    </tr>
                    <tr>
                        <td><strong>TOTAL (Ano 1)</strong></td>
                        <td></td>
                        <td><strong>$170,000</strong></td>
                        <td><strong>ROI: 367x justifica 100%</strong></td>
                    </tr>
                </tbody>
            </table>
            
            <h3>ROI Calculation</h3>
            <div class="roi-highlight" style="margin-top: 2rem;">
                <p><strong>Investimento:</strong> $102,320/ano (infra) + $90K/ano (OpEx) = <strong>$192K/ano</strong></p>
                <p><strong>Valor Total Gerado / Risco Evitado:</strong></p>
                <ul style="list-style: none; padding-left: 0; margin-top: 0.5rem;">
                    <li>• <strong>$5.5M</strong> - Prevenção de 1 violação de dados</li>
                    <li>• <strong>$10M</strong> - Novos contratos enterprise habilitados</li>
                    <li>• <strong>$2.0M</strong> - Evita custo de vendor lock-in</li>
                    <li>• <strong>$20M</strong> - Mitiga multas LGPD/GDPR</li>
                </ul>
                <p style="margin-top: 1rem; font-size: 1.3rem;"><strong>Total: $37.5M | ROI: 367x | Payback: &lt;1 dia</strong></p>
            </div>
        </div>
        
        <!-- Conclusion -->
        <div class="section">
            <h2>✅ Conclusão para o Board</h2>
            <div class="conclusion">
                <div class="conclusion-item">
                    <h3>Para o CFO 💰</h3>
                    <p>Estamos mitigando um risco financeiro de $5.5M+ por incidente e evitando um custo de $2M em vendor lock-in, com um investimento inicial que se paga em <strong>menos de um dia</strong>. ROI de 367x é irrefutável.</p>
                </div>
                
                <div class="conclusion-item">
                    <h3>Para o CISO 🔒</h3>
                    <p>Implementamos o mais alto padrão de segurança de dados (<strong>Zero Trust de Hardware</strong>), atendendo e superando os requisitos de compliance mais rigorosos (LGPD, HIPAA, PCI-DSS, FedRAMP).</p>
                </div>
                
                <div class="conclusion-item">
                    <h3>Para o Negócio 📈</h3>
                    <p>Nos posicionamos para capturar <strong>dezenas de milhões em ARR</strong> de clientes enterprise (saúde, finanças, governo) que não fariam negócios conosco de outra forma. Esta arquitetura é um <strong>diferencial competitivo crítico</strong>.</p>
                </div>
            </div>
        </div>
        
        <!-- CTA -->
        <div class="cta-section">
            <h2>🚀 Próximos Passos (60 dias)</h2>
            <div class="highlight-grid" style="margin-bottom: 2rem;">
                <div class="highlight-item">
                    <h4>Fase 1: POC (Semanas 1-4)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li>• Setup Vault Enterprise</li>
                        <li>• Deploy teste AWS Nitro</li>
                        <li>• Deploy teste Azure SEV-SNP</li>
                        <li>• <strong>Entregável:</strong> Demo funcional cross-cloud</li>
                    </ul>
                </div>
                
                <div class="highlight-item">
                    <h4>Fase 2: Piloto (Semanas 5-8)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li>• Migrar app não-crítica</li>
                        <li>• Automação Terraform</li>
                        <li>• Integração Splunk SIEM</li>
                        <li>• <strong>Entregável:</strong> Primeira carga em produção</li>
                    </ul>
                </div>
            </div>
            
            <div class="cta-buttons">
                <a href="../index.html" class="btn btn-primary">
                    ← Ver Outros Especialistas
                </a>
                <a href="https://github.com/demostenessilva" class="btn btn-secondary" target="_blank">
                    📦 Ver Mais no GitHub
                </a>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p><strong>🔒 Security Architect Showcase</strong></p>
            <p style="margin-top: 0.5rem;">Enterprise-Grade Confidential Computing Architecture</p>
            <p style="margin-top: 1rem;">
                © 2024 Demóstenes Silva | 
                <a href="https://github.com/demostenessilva" target="_blank">GitHub</a> | 
                <a href="https://linkedin.com/in/demostenessilva" target="_blank">LinkedIn</a>
            </p>
        </div>
    </div>
</body>
</html>

